<a [routerLink]="['/projects', projectId]" class="text-sm underline text-gray-600">← Retour au projet</a>

<div class="max-w-2xl mt-4">
  <h1 class="text-2xl font-semibold mb-4">Nouvelle tâche</h1>

  <form [formGroup]="form" (ngSubmit)="submit()" class="grid gap-4">
    <div>
      <label class="block text-sm font-medium mb-1">Titre</label>
      <input class="w-full border rounded p-2" formControlName="title" placeholder="Titre de la tâche" />
    </div>

    <div>
      <label class="block text-sm font-medium mb-1">Description</label>
      <textarea class="w-full border rounded p-2" rows="4" formControlName="description"></textarea>
    </div>

    <div class="grid grid-cols-2 gap-4">
      <div>
        <label class="block text-sm font-medium mb-1">Statut</label>
        <select class="w-full border rounded p-2" formControlName="status">
          <option value="TODO">À faire</option>
          <option value="IN_PROGRESS">En cours</option>
          <option value="DONE">Terminée</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium mb-1">Priorité</label>
        <select class="w-full border rounded p-2" formControlName="priority">
          <option value="LOW">Basse</option>
          <option value="MEDIUM">Moyenne</option>
          <option value="HIGH">Haute</option>
        </select>
      </div>
    </div>

    <div class="grid grid-cols-2 gap-4">
      <div>
        <label class="block text-sm font-medium mb-1">Échéance</label>
        <input type="date" class="w-full border rounded p-2" formControlName="deadline" />
      </div>
      <div>
        <label class="block text-sm font-medium mb-1">Date de fin</label>
        <input type="date" class="w-full border rounded p-2" formControlName="endDate" />
      </div>
    </div>

    <div>
      <label class="block text-sm font-medium mb-1">Assigner à</label>
      <select class="w-full border rounded p-2" formControlName="assigneeEmail">
        <option value="">— (personne)</option>
        <option *ngFor="let m of members" [value]="m.email">
          {{ m.username || m.email }} <ng-container *ngIf="m.email && m.username">({{ m.email }})</ng-container>
        </option>
      </select>
      <p *ngIf="serverError" class="text-sm text-red-700 mt-2">{{ serverError }}</p>
    </div>

    <div class="pt-2">
      <button class="px-4 py-2 rounded bg-black text-white disabled:opacity-50" [disabled]="form.invalid || submitting">
        {{ submitting ? 'Création…' : 'Créer la tâche' }}
      </button>
    </div>
  </form>
</div>
