<div class="max-w-5xl mx-auto p-6">
  <a [routerLink]="['/projects', projectId]" class="text-sm underline text-gray-600">← Retour au projet</a>

  <div class="flex items-center justify-between mt-2">
    <h1 class="text-2xl font-semibold">Détails de la tâche</h1>
    <a class="text-sm underline" (click)="load()">Rafraîchir</a>
  </div>

  <div *ngIf="loading" class="mt-3 text-gray-600">Chargement…</div>
  <div *ngIf="error" class="mt-3 text-red-700 bg-red-50 border border-red-200 p-2 rounded">
    {{ error }}
  </div>

  <div *ngIf="task && !loading" class="mt-4 grid gap-6 md:grid-cols-2 border rounded p-4">
    <div>
      <div class="text-sm text-gray-500">Titre</div>
      <div class="text-lg font-medium">{{ task.title }}</div>
    </div>

    <div>
      <div class="text-sm text-gray-500">Statut</div>
      <div class="text-lg font-medium">{{ task.status }}</div>
    </div>

    <div>
      <div class="text-sm text-gray-500">Priorité</div>
      <div class="text-lg font-medium"
           [class.text-red-600]="task.priority==='HIGH'"
           [class.text-yellow-700]="task.priority==='MEDIUM'"
           [class.text-gray-600]="task.priority==='LOW'">
        {{ task.priority }}
      </div>
    </div>

    <div>
      <div class="text-sm text-gray-500">Créée le</div>
      <div class="text-lg font-medium">
        {{ (task.createdAt || '').toString().replace('T',' ').slice(0,19) }}
      </div>
    </div>

    <div>
      <div class="text-sm text-gray-500">Échéance</div>
      <div class="text-lg font-medium">{{ task.deadline || '—' }}</div>
    </div>

    <div>
      <div class="text-sm text-gray-500">Date de fin</div>
      <div class="text-lg font-medium">{{ task.endDate || '—' }}</div>
    </div>

    <div>
      <div class="text-sm text-gray-500">Assignée à</div>
      <div class="text-lg font-medium">{{ task.assigneeUsername || task.assigneeEmail || '—' }}</div>
    </div>

    <div class="md:col-span-2">
      <div class="text-sm text-gray-500">Description</div>
      <div class="whitespace-pre-wrap">{{ task.description || '—' }}</div>
    </div>

    <div class="md:col-span-2 flex items-center gap-3">
      <!-- Masqué si l’utilisateur n’est pas OWNER/ADMIN/MEMBER -->
      <a *ngIf="isMemberOrAbove()"
         class="px-4 py-2 rounded bg-black text-white"
         [routerLink]="['/projects', projectId, 'tasks', taskId, 'edit']">
        Modifier
      </a>

      <a class="px-4 py-2 rounded border hover:bg-gray-50"
         [routerLink]="['/projects', projectId, 'tasks', taskId, 'history']">
        Historique
      </a>
    </div>
  </div>
</div>
